;FileName_USERCOM.ERB ------------------------------ Rev1.00
;コマンド表示処理
;CALL		SYSTEM
;ARG		VOID
;RETURN		VOID
;COMMENT	
;-----------------------------------------------------------
@SHOW_USERCOM
TFLAG:100 = !TFLAG:101
VARSET LOCAL
;前ターンのMASTERが射精した相手をLOCAL:1へセット
IF TCVAR:MASTER:112 == 1
	;V
	LOCAL:1 = MASTER_POSE(SET_V,SET_P,1)
ELSEIF TCVAR:MASTER:112 == 2
	;A
	LOCAL:1 = MASTER_POSE(SET_A,SET_P,1)
ENDIF

;TARGETが大勢居るときはヒマを持て余す
CALL ANOTHERTARGET_TALK

CALL 情景描写

;IF (FLAG:70 == 1 && TARGET) || CFLAG:TARGET:うふふ
	CALL LOOK_AT
	PRINTL
;ENDIF
CALL DRAW_INFORMATIONLINE("Act_COM")
;PRINT ==Act_COM 
CALL 过滤器表示

;コマンド表示
FOR LOCAL,0,800
	SIF LOCAL == 355 && (!FLAG:70 || CFLAG:TARGET:344 == 1)
		CONTINUE
	SIF LOCAL == 200 && TFLAG:102 == 2
		PRINTL
	SIF LOCAL == 350 && TFLAG:102 != 2
		PRINTL
	SIF LOCAL == 400 && TFLAG:102 != 2
		PRINTL
	SIF GLOBAL_COMABLE2(LOCAL)
		CONTINUE
	SIF GROUPMATCH(LOCAL,400,604)
		CONTINUE
	RESULT = 0
	;現状で対象コマンドが使用可能かどうか判定
	TRYCALLFORM COM_ABLE{LOCAL}
	IF RESULT
		SIF !QUICKFILTER(LOCAL)
			CONTINUE
		IF (LOCAL == 42 && TEQUIP:11) || (LOCAL == 43 && TEQUIP:12) || (LOCAL == 44 && TEQUIP:13) || (LOCAL == 45 && TEQUIP:14) || (LOCAL == 46 && TEQUIP:15) || (LOCAL == 47 && TEQUIP:16) || (LOCAL == 48 && TEQUIP:17)
			PRINTFORMC %TRAINNAME:LOCAL%解除[{LOCAL,3}]
		ELSEIF LOCAL == 81 && LOCAL:1
			PRINTFORMC 清洁口交[{LOCAL,3}]
		ELSEIF LOCAL == 82 && (TALENT:105 == -2 || TALENT:105 == -1)
			PRINTFORMC ナイズリ[{LOCAL,3}]
		ELSEIF LOCAL == 60 && (!BEDROOM(CFLAG:PLAYER:現在位置) && !(BATHROOM() && ITEM:20))
			PRINTFORMC 対面立位[{LOCAL,3}]
		ELSEIF LOCAL == 61 && (!INROOM(CFLAG:PLAYER:現在位置) && !(BATHROOM() && ITEM:20))
			PRINTFORMC 背面立位[{LOCAL,3}]
		ELSEIF LOCAL == 62 && (!BEDROOM(CFLAG:PLAYER:現在位置) && !(BATHROOM() && ITEM:20))
			PRINTFORMC 対面立位肛交[{LOCAL,3}]
		ELSEIF LOCAL == 63 && (!INROOM(CFLAG:PLAYER:現在位置) && !(BATHROOM() && ITEM:20))
			PRINTFORMC 背面立位肛交[{LOCAL,3}]
		ELSEIF LOCAL == 73 && TCVAR:PLAYER:要去了
			IF TEQUIP:TARGET:体位 == 1 && (BEDROOM(CFLAG:PLAYER:現在位置) || (BATHROOM() && ITEM:20))
				PRINTFORMC 種付けプレス[{LOCAL,3}]
			ELSEIF TEQUIP:TARGET:体位 == 2
				IF CFLAG:TARGET:生理周期 == 7
					PRINTFORMC 孕ませ交尾[{LOCAL,3}]
				ELSE
					PRINTFORMC 種付け交尾[{LOCAL,3}]
				ENDIF
			ELSE
				PRINTFORMC %TRAINNAME:LOCAL%[{LOCAL,3}]
			ENDIF
		ELSEIF LOCAL == 92 && (!BEDROOM(CFLAG:PLAYER:現在位置) && !(BATHROOM() && ITEM:20))
			PRINTFORMC 被Ａ対面立位[{LOCAL,3}]
		ELSEIF LOCAL == 93 && (!INROOM(CFLAG:PLAYER:現在位置) && !(BATHROOM() && ITEM:20))
			PRINTFORMC 被Ａ背面立位[{LOCAL,3}]
		ELSEIF LOCAL == 100 && TALENT:TARGET:幼稚
			PRINTFORMC お尻ぺんぺん[{LOCAL,3}]
		ELSEIF LOCAL == 130 && (!BEDROOM(CFLAG:PLAYER:現在位置) && !(BATHROOM() && ITEM:20))
			PRINTFORMC 被対面立位[{LOCAL,3}]
		ELSEIF LOCAL == 131 && (!INROOM(CFLAG:PLAYER:現在位置) && !(BATHROOM() && ITEM:20))
			PRINTFORMC 被背面立位[{LOCAL,3}]
		ELSEIF LOCAL == 301 && CFLAG:TARGET:行動 == 5
			PRINTFORMC 茶を差し入れ[{LOCAL,3}]
		ELSEIF LOCAL == 301 && GETBIT(TCVAR:MASTER:特別的茶水, 0)
			PRINTFORMC 泡紅茶[{LOCAL,3}]
		ELSEIF LOCAL == 334 && CFLAG:TARGET:350 == 49 && (TALENT:TARGET:酒耐性 == -2 || CFLAG:TARGET:妊娠自覚状態 == 1)
			PRINTFORMC 料理を勧める[{LOCAL,3}]
		ELSEIF LOCAL == 304 && CFLAG:TARGET:350 == 46
			PRINTFORMC 玩耍に参加する[{LOCAL,3}]
		ELSEIF LOCAL == 315
			IF GETBIT(TALENT:TARGET:性別,1)
				PRINTFORMC 竿愛撫[{LOCAL,3}]
			ELSEIF CFLAG:MASTER:恶作剧
				PRINTFORMC 秘所愛撫[{LOCAL,3}]
			ELSE
				PRINTFORMC 陰蒂愛撫[{LOCAL,3}]
			ENDIF
		ELSEIF LOCAL == 350
			IF FLAG:70 == 1 && CFLAG:TARGET:344 == 0
				LOCALS = 猥褻
			ELSEIF (CFLAG:現在位置 == 情人用宿屋 || CFLAG:現在位置 == 情人旅館)&& !CFLAG:诶嘿嘿
				LOCALS = 抱到身边
			ELSEIF CFLAG:現在位置 == 寺子屋
				LOCALS = いけない個人授業
			ELSEIF CFLAG:現在位置 == OMANEKIBEYA() && TARGET == 43
				LOCALS = 房中術的修行
			;ベッドがない
			;室外
			ELSEIF !INROOM(CFLAG:PLAYER:現在位置)
				LOCALS = 抱到身边
			ELSE
				LOCALS = 推倒
			ENDIF
			SIF GET_TARGETNUM() > 1
				LOCALS = まとめて%LOCALS%
			PRINTFORMC %LOCALS%[{LOCAL,3}]
		ELSEIF LOCAL == 351 && CFLAG:TARGET:態度 > 0
			SETCOLOR C_AQUA
			PRINTFORMC %TRAINNAME:LOCAL%[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 360 && BASE:MASTER:気力 <= 0
			PRINTFORMC なすがまま[{LOCAL,3}]
		ELSEIF LOCAL == 366 && GROUPMATCH(IRAI_CHARA_TO_PROGRESS(TARGET), "依頼達成", "依頼失敗")
			SETCOLOR C_GREEN
			PRINTFORMC 依頼の報告[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 366 && GROUPMATCH(IRAI_CHARA_TO_PROGRESS(TARGET), "依頼未受託")
			SETCOLOR C_GREEN
			PRINTFORMC 聽取依頼[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 367
			SETCOLOR C_GREEN
			PRINTFORMC %NAME_IRAI_ACT()%[{LOCAL,3}]
			RESETCOLOR
		ELSEIF LOCAL == 417 && TIME >= 660 && TIME <= 900
			PRINTFORMC 午睡[{LOCAL,3}]
		ELSEIF LOCAL == 417
			PRINTFORMC 假寐する[{LOCAL,3}]
		ELSEIF LOCAL == 420
			SELECTCASE MAIN_MAP
				CASE 0
					LOCALS = 留琴
				CASE 3
					LOCALS = 女仆妖精
				CASE 9
					LOCALS = 僵尸妖精
			ENDSELECT
			PRINTFORMC %LOCALS%と話す[{LOCAL,3}]
		ELSEIF LOCAL == 422 && CFLAG:MASTER:現在位置 == 103
			PRINTFORMC 御仏の声を聴く[{LOCAL,3}]
		ELSEIF LOCAL == 431 && (CFLAG:MASTER:現在位置 == 24 || CFLAG:MASTER:現在位置 == 441)
			PRINTFORMC 温泉でくつろぐ[{LOCAL,3}]
		ELSEIF LOCAL == 431 && (CFLAG:MASTER:現在位置 == 大衆浴場 || CFLAG:MASTER:現在位置 == 940)
			PRINTFORMC 入浴する[{LOCAL,3}]
		ELSEIF LOCAL == 431 && !SMALL_PLACE(CFLAG:MASTER:現在位置) && GETBIT (FLAG:泳池, 1) && !BATHCHECK(CFLAG:MASTER:現在位置)
			PRINTFORMC 泳池でくつろぐ[{LOCAL,3}]
		ELSEIF LOCAL == 405 && CFLAG:TARGET:同行 && TARGET
			PRINTFORMC 约会[{LOCAL,3}]
		ELSEIF LOCAL == 410 && OUTROOF(CFLAG:MASTER:現在位置) && DAY:2 == 4
			PRINTFORMC 扫雪[{LOCAL,3}]
		ELSEIF LOCAL == 414 && TIME >= 300 && TIME <= 540 && (CFLAG:MASTER:現在位置 == 9 || CFLAG:MASTER:現在位置 == OMANEKIBEYA())
			PRINTFORMC 朝食にする[{LOCAL,3}]
		ELSEIF LOCAL == 414 && TIME >= 660 && TIME <= 900 && (CFLAG:MASTER:現在位置 == 9 || CFLAG:MASTER:現在位置 == OMANEKIBEYA())
			PRINTFORMC 昼食にする[{LOCAL,3}]
		ELSEIF LOCAL == 414 && TIME >= 1020 && TIME <= 1200 && (CFLAG:MASTER:現在位置 == 9 || CFLAG:MASTER:現在位置 == OMANEKIBEYA())
			PRINTFORMC 夕食にする[{LOCAL,3}]
		ELSEIF LOCAL == 414 && TIME >= 1200 && TIME <= 1440 && (CFLAG:MASTER:現在位置 == 9 || CFLAG:MASTER:現在位置 == OMANEKIBEYA())
			PRINTFORMC 晩食にする[{LOCAL,3}]
		ELSEIF LOCAL == 414 && TIME >= 0 && TIME <= 180 && (CFLAG:MASTER:現在位置 == 9 || CFLAG:MASTER:現在位置 == OMANEKIBEYA())
			PRINTFORMC 夜食にする[{LOCAL,3}]
		ELSEIF LOCAL == 414 && CFLAG:TARGET:行動 == 5
			PRINTFORMC 吃飯休憩[{LOCAL,3}]
		ELSEIF LOCAL == 443
			PRINTFORMC %NAME_UNIQUE_COM(TARGET)%[{LOCAL,3}]
		ELSEIF LOCAL == 464
			LOCALS = %STR:(6000 + SPECIAL_AREAMOVE() / 10)%
			PRINTFORMC %LOCALS%へ[{LOCAL,3}]
		ELSEIF LOCAL == 603 && PREVCOM == 603
			PRINTFORMC 拉手[{LOCAL,3}]
		ELSEIF LOCAL == 698
			PRINTFORMC %OMANEKI_PLACE()%に行く[{LOCAL,3}]
		ELSEIF STRLENS(TRAINNAME:LOCAL)
			PRINTFORMC %TRAINNAME:LOCAL%[{LOCAL,3}]
		ENDIF
	ENDIF
NEXT
RESULT = 0
;自動実行中なら下記表示をスキップ
SIF !TFLAG:100
	GOTO SKIP
PRINTL
CALL DRAW_INFORMATIONLINE("Ex_COM")
;SIF !GETBIT (FLAG:USERCOMフィルタ, 12)
;	PRINTC 履歴表示[800]
IF GETBIT(FLAG:瞬間移動, 1) && !CFLAG:MASTER:同行
	SETCOLOR 0x5090FF
ELSE
	SETCOLOR C_GREEN
ENDIF
RESULT = 0
CALL COM_ABLE400
SIF RESULT
	PRINTC 移動[400]
IF GETBIT(FLAG:瞬間移動, 0) && !FLAG:约会的对象
	SETCOLOR 0x5090FF
ELSE
	SETCOLOR C_GREEN
ENDIF
RESULT = 0
CALL COM_ABLE604
SIF RESULT
	PRINTC 散步[604]
RESETCOLOR
SIF !GETBIT (FLAG:USERCOM开关, 0)
	PRINTC 污渍显示[801]
SIF !CFLAG:陪睡中 && GET_TARGETNUM() > 1 && !GETBIT (FLAG:USERCOM开关, 1)
	PRINTC 相手を変える[802]
SIF !GETBIT (FLAG:USERCOM开关, 2)
	PRINTC 能力表示[803]
SIF !GETBIT (FLAG:USERCOM开关, 3)
	PRINTC 能力表示(マ斯塔)[804]
SIF !GETBIT(FLAG:USERCOM开关, 11)
	PRINTC 指令过滤器[809]
SIF FLAG:1005
	PRINTC CONFIG[810]
SIF TALENT:MASTER:居場所察知 && AT_HOME(MASTER) && !CFLAG:诶嘿嘿 && !CFLAG:陪睡中
	PRINTC 居場所察知[811]
SIF TALENT:MASTER:汚部屋察知 && AT_HOME(MASTER) && !CFLAG:诶嘿嘿 && !CFLAG:陪睡中
	PRINTC 汚部屋察知[812]
SIF TALENT:MASTER:劣情察知 > 1 && !CFLAG:诶嘿嘿
	PRINTC 劣情探知[813]
SIF FLAG:70 && CFLAG:TARGET:344 == 0 && !CFLAG:TARGET:睡眠 && AT_HOME(MASTER) == 1 && TARGET > 0 && !CFLAG:诶嘿嘿
	PRINTC 携带[815]
SIF FLAG:70 && TALENT:MASTER:集合 && AT_HOME(MASTER) == 1 && !CFLAG:诶嘿嘿
	PRINTC 集合[817]
IF CAN_DATE(TARGET)
	SIF TIME_REQUIRED(MAIN_MAP,CFLAG:MASTER:约会中) < 10
		SETCOLOR 100, 250, 140
	PRINTFORMC %GET_MAPNAME(MAIN_MAP)%に誘う({TIME_REQUIRED(MAIN_MAP,CFLAG:MASTER:约会中)}分)[990]
	RESETCOLOR
ENDIF
;SIF CFLAG:MASTER:初期位置 == 53 && CFLAG:MASTER:現在位置 == 53 && !FLAG:納戸施錠
;	PRINTC 鍵を閉める[991]
;SIF CFLAG:MASTER:初期位置 == 53 && CFLAG:MASTER:現在位置 == 53 && FLAG:納戸施錠
;	PRINTC 鍵を開ける[991]
;;ワープ移動したときのために
;IF FLAG:納戸施錠 && CFLAG:MASTER:現在位置 != 53
;	SETCOLOR 0 , 255, 0
;	PRINTC ※遠隔鍵解錠[991]
;	RESETCOLOR
;ENDIF
SIF CHK_DATENOW(CFLAG:MASTER:约会中) && (!FLAG:70 || CFLAG:TARGET:344 == 1) && CFLAG:行動 != 5 && CFLAG:6 && !CHK_DATENOW(CFLAG:TARGET:约会中) && VISIT(TARGET) && CFLAG:MASTER:現在位置 != OMANEKIBEYA() && !FLAG:约会的对象 && (TALENT:TARGET:思慕 || TALENT:TARGET:恋慕 || TALENT:TARGET:愛欲) && TFLAG:妄想中 != 1
	PRINTC 邀请去约会[992]
SIF CFLAG:MASTER:現在位置 == CFLAG:MASTER:初始位置
	PRINTC 日历[993]
SIF FLAG:パンツ輸送
	PRINTC 手持パンツ確認[994]
IF AT_HOME(MASTER) && GETBIT(FLAG:瞬間移動, 1)
	SETCOLOR 0x5090FF
ELSEIF !AT_HOME(MASTER) && GETBIT(FLAG:瞬間移動, 0)
	SETCOLOR 0x5090FF
ENDIF
SIF !GETBIT(FLAG:USERCOM开关, 13)
	PRINTC 自動時止め移動[995]
RESETCOLOR
PRINTL
IF FLAG:70 == 1 && CFLAG:TARGET:344 == 0
	SIF EQUIP:0 && TARGET && CFLAG:诶嘿嘿
		PRINTC 脱衣服[820]
	SIF EQUIP:0 && TARGET && EQUIP:TARGET:下半身下着２ != 0
		PRINTC パンツをくすねる[821]
	IF (TEQUIP:5 == 0 || EQUIP:TARGET:上半身下着１) && CFLAG:诶嘿嘿
		SIF EQUIP:0 && TARGET && EQUIP:TARGET:上半身下着１ != 0 && (EQUIP:TARGET:和服 != 0 || EQUIP:TARGET:上半身外衣２ != 0 || EQUIP:TARGET:連体内衣 == 3)
			PRINTC 上下着を外す[822]
	ENDIF
	IF TEQUIP:5 == 0 && CFLAG:诶嘿嘿
		SIF EQUIP:0 && TARGET && (EQUIP:TARGET:上半身下着１ != 0 || EQUIP:TARGET:上半身下着２ != 0 || EQUIP:TARGET:下半身下着１ != 0 || EQUIP:TARGET:下半身下着２ != 0 || EQUIP:TARGET:緊身内衣 != 0 || EQUIP:TARGET:連体内衣 != 0) && (EQUIP:TARGET:14 != 0 || EQUIP:TARGET:15 != 0 || EQUIP:TARGET:16 != 0 || EQUIP:TARGET:17 != 0 || EQUIP:TARGET:18 != 0)
			PRINTC 下着姿にする[823]
	ENDIF
	IF MEASUREMENTCHECK(CFLAG:TARGET:現在位置)
		IF CFLAG:TARGET:身体測定 != 2
			PRINTC 身体測定する[824]
		ELSE
			PRINTC 身体測定を終える[824]
		ENDIF
	ENDIF
	SIF TFLAG:パンツ収奪
		PRINTC パンツ収奪[825]
	IF TARGET
		IF TEQUIP:挑逗モード
			PRINTC 挑逗終了[826]
		ELSE
			PRINTC 挑逗[826]
		ENDIF
	ENDIF
	IF CFLAG:诶嘿嘿
		PRINTC 恶作剧をやめる[999]
	ELSE
		PRINTC 時間停止解除[999]
	ENDIF
ELSEIF FLAG:70 == 1 && CFLAG:TARGET:344 == 1
		PRINTC 時間停止解除[999]
	IF CFLAG:诶嘿嘿
		SIF EQUIP:0 && TARGET
			PRINTC 脱衣服[820]

		IF CFLAG:诶嘿嘿 == 2
			IF TFLAG:抱住模式
				PRINTC 摆脱[850]
			ELSE
				PRINTC 摆脱[850]
			ENDIF
			IF TEQUIP:挑逗モード
				PRINTC 挑逗終了[826]
			ELSE
				PRINTC 挑逗[826]
			ENDIF
		ELSE
			PRINTC 逢引終了[999]
		ENDIF
	ENDIF
ELSEIF CFLAG:诶嘿嘿 && !CFLAG:恶作剧
	SIF EQUIP:0 && TARGET && !(TFLAG:102 == 3 && TFLAG:抱住模式)
		PRINTC 脱衣服[820]
		IF TARGET
			IF TEQUIP:挑逗モード
				PRINTC 挑逗終了[826]
			ELSE
				PRINTC 挑逗[826]
			ENDIF
		ENDIF
	IF FLAG:70 == 1 && CFLAG:TARGET:344 == 0
		PRINTC 時間停止解除[999]
	ELSEIF CFLAG:诶嘿嘿 == 2
		IF TFLAG:抱住模式
			PRINTC 摆脱[850]
		ELSE
			PRINTC 摆脱[850]
		ENDIF
	ELSE
		PRINTC 逢引終了[999]
	ENDIF
ENDIF

IF CFLAG:恶作剧
	SIF CFLAG:恶作剧 < 2 && (EXP:TARGET:睡眠姦経験 > 100 || TCVAR:睡眠薬強度 || TCVAR:睡眠深度 > 2000)
		PRINTC 服をはだける[830]
	IF CFLAG:恶作剧 < 2
		PRINTC 恶作剧終了[999]
		SIF EQUIP:TARGET:下半身下着２ != 0
			PRINTC パンツをくすねる[821]
	ENDIF
	SIF CFLAG:恶作剧 > 1
	PRINTC 睡眠姦終了[999]
ENDIF
IF CFLAG:陪睡中
	PRINTC 添い寝終了[999]
ENDIF
IF CHK_DATENOW(CFLAG:MASTER:约会中) && (!FLAG:70 || CFLAG:TARGET:344 == 1) && !CFLAG:MASTER:诶嘿嘿 && CFLAG:MASTER:現在位置 != OMANEKIBEYA() && TFLAG:妄想中 != 1
	SIF TIME_REQUIRED(MAIN_MAP,CFLAG:MASTER:约会中) < 10
		SETCOLOR 100, 250, 140
	PRINTFORMC 帰路につく({TIME_REQUIRED(MAIN_MAP,CFLAG:MASTER:约会中)}分)[999]
	RESETCOLOR
ENDIF
$SKIP
IF PREVCOM >= 0
	IF TFLAG:151
		STR:0 = %STR:(1500 + TFLAG:151)%
	ELSE
		STR:0 = %TRAINNAME:PREVCOM%
	ENDIF
ENDIF
SIF PREVCOM == 304 && CFLAG:TARGET:350 == 49 && TALENT:TARGET:酒耐性 != -2
	STR:0 = 碰杯
SIF PREVCOM == 304 && CFLAG:TARGET:350 == 49 && (TALENT:TARGET:酒耐性 == -2 || CFLAG:TARGET:妊娠自覚状態 == 1)
	STR:0 = 料理を勧める
SIF PREVCOM == 304 && CFLAG:TARGET:350 == 51
	STR:0 = 照料
IF PREVCOM >= 0 && PREVCOM < 300
	PRINTL 
	PRINT ＜前回調教指令:
	PRINTS STR:0
	SIF TFLAG:150
		PRINT (助手)
	PRINTL ＞
ELSE
	PRINTL 
	PRINT ＜前回指令:
	PRINTS STR:0
	PRINTL ＞
ENDIF
