;FileName_SYSTM.ERB -------------------------------- Rev1.00
;ニューゲーム処理
;CALL		SYSTEM
;ARG		VOID
;RETURN		VOID
;COMMENT	
;-----------------------------------------------------------
@EVENTFIRST
;ターゲット・アシスタント初期化
TARGET = 0
ASSI = 0

PBAND = 12

CALL MAKE_ALL_CLASS_LIST
;デフォルトオプション
CALL DEFAULT_OPTION

CALL ADD_ALL_CHARACTERS
;MASTER生成
CALL CUSTOM_CHARAMAKE(MASTER)
;チ○コ有りなら勃起値セット
IF TALENT:MASTER:2 & 2
	MAXBASE:MASTER:5 = 1500
	CALL TINKO_DECIDE(MASTER)
ENDIF
MAXBASE:MASTER:TSP = 100
BASE:MASTER:TSP = 100

;初期地点設定

FOR LOCAL,0,CHARANUM
	;開始位置
	CFLAG:LOCAL:現在位置 = CFLAG:LOCAL:初始位置
	;服装
	CALL SELECT_CLOTHES(LOCAL, "便服")
	CALL CTRL_CLOTHES_SET(LOCAL, "現在衣装の変更_便装")
	CALL CLOTHES_SETTING_TRAIN(LOCAL)
	CALL 内衣確認リセット(LOCAL)
	SIF !EXP:LOCAL:接吻経験
		TALENT:LOCAL:無接吻経験 = 1
NEXT

;MASTER起床時間セット（7時）
TIME:3 = 420

CALL KAISYONASI

;MASTER睡眠中フラグON
CALL SET_SLEEP(1,MASTER,0)

CALL SET_NOUMIN
CALL SET_MAINHOME
CALL VIRGIN_SET

CALL SET_CHARISMA("NEW")
;CALL CHARA_CUSTOM
SIF !CM_LIMIT
	CM_LIMIT = 100
;日付１日目
DAY = 1
DAY:2 = 1
DAY:3 = 1
FLAG:酒虫 = 1
FLAG:画像表示 = 1
FLAG:兒童描写 = 1

;溜まってる度の初期設定
FOR LOCAL,1,CHARANUM
	CFLAG:LOCAL:积攒度 = RAND:500
NEXT
;依頼：手紙の宛先処理
CALL SETUP_ALL_LETTERS

FOR LOCAL,1,CHARANUM
	IF TALENT:LOCAL:路人
		RANDOM_CHARANUM = LOCAL
		BREAK
	ENDIF
NEXT

;本体バージョンを記録
SAVESTR:本体バージョン = %eraTW_Version%
FLAG:家事過濾器 = 1
CALL NEWGAME_BONUS


;SYSTEMCALL to SHOW_SHOP
BEGIN SHOP

@EVENTLOAD
GETTIME
DEBUGPRINTFORML {RESULT / 10000000000000}年 {(RESULT / 100000000000) % 100}月 {(RESULT / 1000000000) % 100}日 {(RESULT / 10000000) % 100}時だよ
CALL ROOMSETTING
CALL VERSION_UP
SIF CFLAG:MASTER:312
	TIME:3 = CFLAG:MASTER:312
CFLAG:MASTER:312 = 0
CALL MAKE_ALL_CLASS_LIST
;依頼：手紙の宛先処理
CALL SETUP_ALL_LETTERS
FOR LOCAL,1,CHARANUM
	IF TALENT:LOCAL:路人
		RANDOM_CHARANUM = LOCAL
		BREAK
	ENDIF
NEXT

@VIRGIN_SET
PRINTL 游戏開始前可以变更各个人物的処女・非処女状况。
DRAWLINE
PRINTL [0] 設定終了
PRINTL [1] 個別設定
PRINTL [2] 你是笨蛋吗肯定得全员处女啊
PRINTL [3] 幻想少女很長寿所以肯定経験豊富吧
PRINTL [4] 干脆全部都变的风骚吧
PRINTL [5] 全部少女都变成幼女吧
PRINTL [6] 全变成小人+動物耳吧
PRINTL [7] 全員長出小丁丁
PRINTL [8] 雖然全員都是処女但是褲腰帯都很鬆
PRINTL [9] 全员都不知道什么叫做爱
PRINTL [10] 全员回到初始设定
$LOOP
INPUT
SELECTCASE RESULT
	CASE 0
		PRINTW 設定完毕。
		RETURN
	CASE 1
		CALL SET_VIRGINITY
	CASE 2
		FOR LOCAL,1,CHARANUM
			CALL SET_VIRGIN(LOCAL)
		NEXT
		PRINTW 你个処女厨！
		PRINTW 全員变为了処女。
	CASE 3
		FOR LOCAL,1,CHARANUM
			TALENT:LOCAL:処女 = 0
			SIF TALENT:LOCAL:性別嗜好 == 1
				TALENT:LOCAL:性別嗜好 = 0
			EXP:LOCAL:Ｖ経験 = MAX(EXP:LOCAL:Ｖ経験, 50)
			ABL:LOCAL:Ｖ感覚 = MAX(ABL:LOCAL:Ｖ感覚, 2)
			ABL:LOCAL:腰 = MAX(ABL:LOCAL:腰, 2)
			EXP:LOCAL:Ｖ性交経験 = MAX(EXP:LOCAL:Ｖ経験, 50)
			EXP:LOCAL:Ｖ拡張経験 = MAX(EXP:LOCAL:Ｖ拡張経験, 3)
			EXP:LOCAL:精液経験 = MAX(EXP:LOCAL:精液経験, 10)
		NEXT
		PRINTW 全员变更为非処女了。
	CASE 4
		FOR LOCAL,1,CHARANUM
			CALL SET_YARIMAN(LOCAL)
		NEXT
		PRINTW 全员都变的风骚了。
	CASE 5
		FOR LOCAL,1,CHARANUM
			CALL SET_LOLI(LOCAL)
		NEXT
		IF TALENT:MASTER:形状 < 6
			PRINTFORML 偶尔当当萝莉控也不错呢！
			PRINTFORML
			PRINTW 全员变更为幼女了。
		ELSE
			PRINTFORML 你个禽兽！
			PRINTFORML
			PRINTW 全员变更为幼女了。
		ENDIF
	CASE 6
		FOR LOCAL,1,CHARANUM
			TALENT:LOCAL:体型 = -5
			TALENT:LOCAL:143 = 1
		NEXT
		IF TALENT:MASTER:形状 < 3
			PRINTW 全员变更为小人+動物耳了。
		ELSE
			PRINTFORML 你个畜生！
			PRINTFORML 
			PRINTW 全员变更为小人+動物耳了。
		ENDIF
	CASE 7
		FOR LOCAL,1,CHARANUM
			TALENT:LOCAL:2 = 3
			TALENT:LOCAL:形状 = 3
			MAXBASE:LOCAL:5 = 1500
			MAXBASE:LOCAL:精力 = 1000
		NEXT
		PRINTFORMW 全員變成了扶她。
	CASE 8
		PRINTFORMW 麻烦的家伙。
		FOR LOCAL,1,CHARANUM
			TALENT:LOCAL:処女 = 1
			SIF TALENT:LOCAL:性別嗜好 == 1
				TALENT:LOCAL:性別嗜好 = 0
			EXP:LOCAL:Ｖ経験 = 0
			ABL:LOCAL:Ｖ感覚 = 0
			ABL:LOCAL:欲望 = 3
			EXP:LOCAL:Ｖ性交経験 = 0
			EXP:LOCAL:Ｖ拡張経験 = 0
			EXP:LOCAL:精液経験 = 0
			EXP:LOCAL:接吻経験 = 0
			TALENT:LOCAL:風騷 = 1
			TALENT:LOCAL:無接吻経験 = 1
			TALENT:LOCAL:貞操 = -1
		NEXT
		PRINTW 全员都变成了风骚的碧池处女
	CASE 9
		FOR LOCAL,1,CHARANUM
			CALL SET_VIRGIN(LOCAL)
			TALENT:LOCAL:無知 = 1
		NEXT
		PRINTW 小兎姫在此。
		PRINTW 全员都变成了无知的纯洁处女
	CASE 10
		FOR LOCAL,1,CHARANUM
			CALL RESET_CHARA(LOCAL)
		NEXT
		PRINTFORMW 全員恢復為了初期設定。
	CASEELSE
		GOTO LOOP
ENDSELECT
RESTART

@SET_VIRGINITY
#DIM CHARA_ID
FOR CHARA_ID, 1, CHARANUM
	SIF TALENT:CHARA_ID:処女
		SETCOLOR C_PINK
	SIF TALENT:CHARA_ID:風騷
		SETCOLOR C_P_BLUE
	PRINTFORMLC [{CHARA_ID, 3}] %CALLNAME:CHARA_ID%
	RESETCOLOR
NEXT
PRINTL 　
DRAWLINE
PRINTL [999] 設定終了
DO
	INPUT
	CHARA_ID = RESULT
	SELECTCASE CHARA_ID
	CASE 999
		PRINTW 個別設定完畢。
		RETURN
	CASE 1 TO CHARANUM
		BREAK
	CASEELSE
	ENDSELECT
LOOP 1

IF TALENT:CHARA_ID:風騷
	IF CSVTALENT(CHARA_ID, GETNUM(TALENT, "処女")) == 1
		PRINTFORMW %CALLNAME:CHARA_ID%的能力恢復為了初期設定
		CALL RESET_CHARA(CHARA_ID)
	ELSE
		PRINTFORMW %CALLNAME:CHARA_ID%変成処女了
		CALL SET_VIRGIN(CHARA_ID)
	ENDIF
ELSEIF TALENT:CHARA_ID:処女
	IF CSVTALENT(CHARA_ID, GETNUM(TALENT, "処女")) == 0
		PRINTFORMW %CALLNAME:CHARA_ID%的能力恢復為了初期設定
		CALL RESET_CHARA(CHARA_ID)
	ELSE
		PRINTFORMW %CALLNAME:CHARA_ID%変成非処了
		TALENT:CHARA_ID:処女 = 0
	ENDIF
ELSE
	PRINTFORMW %CALLNAME:CHARA_ID%変得风骚了
	CALL SET_YARIMAN(CHARA_ID)
ENDIF
RESTART

@SET_VIRGIN(ARG)
TALENT:ARG:処女 = 1
EXP:ARG:Ｃ経験 = 0
EXP:ARG:Ｂ経験 = 0
EXP:ARG:Ｖ経験 = 0
EXP:ARG:Ａ経験 = 0
ABL:ARG:Ｖ感覚 = 0
ABL:ARG:Ａ感覚 = 0
EXP:ARG:Ｖ性交経験 = 0
EXP:ARG:Ｖ拡張経験 = 0
EXP:ARG:Ａ性交経験 = 0
EXP:ARG:Ａ拡張経験 = 0
EXP:ARG:手淫経験 = 0
EXP:ARG:口淫経験 = 0
EXP:ARG:乳交経験 = 0
EXP:ARG:接吻経験 = 0
EXP:ARG:奉仕快楽経験 = 0
EXP:ARG:愛情経験 = 0
EXP:ARG:苦痛快楽経験 = 0
EXP:ARG:嗜虐快楽経験 = 0
EXP:ARG:露出快楽経験 = 0
EXP:ARG:緊縛経験 = 0
EXP:ARG:絶頂経験 = 0
EXP:ARG:射精経験 = 0
EXP:ARG:噴乳経験 = 0
EXP:ARG:放尿経験 = 0
EXP:ARG:精液経験 = 0
EXP:ARG:精飲経験 = 0
EXP:ARG:出産経験 = 0
TALENT:ARG:無接吻経験 = 1
TALENT:ARG:風騷 = 0
TALENT:ARG:性別嗜好 = CSVTALENT(ARG,81)
TALENT:ARG:貞操 = CSVTALENT(ARG,30)
ABL:ARG:腰 = CSVABL(ARG, GETNUM(ABL, "腰"))
ABL:ARG:欲望 = CSVABL(ARG, GETNUM(ABL, "欲望"))

@SET_YARIMAN(ARG)
TALENT:ARG:処女 = 0
SIF TALENT:ARG:性別嗜好 == 1
	TALENT:ARG:性別嗜好 = 0
EXP:ARG:Ｖ経験 = MAX(EXP:ARG:Ｖ経験, 100)
ABL:ARG:Ｖ感覚 = MAX(ABL:ARG:Ｖ感覚, 3)
ABL:ARG:腰 = MAX(ABL:ARG:腰, 3)
ABL:ARG:欲望 = 3
EXP:ARG:Ｖ性交経験 = MAX(EXP:ARG:Ｖ経験, 100)
EXP:ARG:Ｖ拡張経験 = MAX(EXP:ARG:Ｖ拡張経験, 3)
EXP:ARG:精液経験 = MAX(EXP:ARG:精液経験, 50)
TALENT:ARG:風騷 = 1
TALENT:ARG:貞操 = -1

@SET_LOLI(ARG)
TALENT:ARG:胸圍 = MAX(TALENT:ARG:胸圍 - 2, -2)
TALENT:ARG:体型 = -2

;強くてニューゲームでも使用される
;CFLAGのリセットは引き継ぎに支障があるので禁止
@RESET_CHARA(ARG)
FOR LOCAL, 0, VARSIZE("TALENTNAME")
	TALENT:ARG:LOCAL = CSVTALENT(ARG, LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("EXPNAME")
	EXP:ARG:LOCAL = CSVEXP(ARG, LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("ABLNAME")
	ABL:ARG:LOCAL = CSVABL(ARG, LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("EXPNAME")
	EXP:ARG:LOCAL = CSVEXP(ARG, LOCAL)
NEXT
FOR LOCAL, 0, VARSIZE("BASENAME")
	BASE:ARG:LOCAL = CSVBASE(ARG, LOCAL)
	MAXBASE:ARG:LOCAL = BASE:ARG:LOCAL
NEXT

@NEWGAME_BONUS
SETCOLOR 103,228,126
PRINTFORML 【新遊戲特典】
RESETCOLOR
$TOKUTEN
PRINTFORML 請選擇你喜歡的一項
CALL ASK_M("￥10000", 1 ,"初期好感度・信頼度UP",1, "初期TSP500", 1, "獨佔愛慾的奇跡之石", 1)
SELECTCASE RESULT
	CASE 0
		PRINTFORML \\10000円初始資金開局可以嗎？
		CALL ASK_YN
		IF !RESULT
			MONEY += 10000
			PRINTFORMW \\獲得了10000円
		ELSE
			GOTO TOKUTEN
		ENDIF
	CASE 1
		PRINTFORML 自選一個角色初期好感度500、信賴度50
		PRINTFORML 請選擇對象
		FOR LOCAL,1,CHARANUM
			SIF !TALENT:LOCAL:路人
				PRINTFORMLC [{LOCAL}] %CALLNAME:LOCAL%
		NEXT
		PRINTFORML 
		DRAWLINE
		PRINTFORML [999] 返回
		INPUT
		IF INRANGE(RESULT,1,CHARANUM)
			CFLAG:RESULT:好感度 = 500
			CFLAG:RESULT:信頼度 = 50
			PRINTFORMW %CALLNAME:RESULT%的好感度和信頼度上升了
		ELSE
			GOTO TOKUTEN
		ENDIF
	CASE 2
		PRINTFORML 初期的時停能力獲得一定成長的狀態下開局、可以吗？
		CALL ASK_YN
		IF !RESULT
			MAXBASE:MASTER:TSP = 500
			BASE:MASTER:TSP = MAXBASE:MASTER:TSP
			MONEY:1 = 1800
			PRINTFORMW 時停能力成長了
		ELSE
			GOTO TOKUTEN
		ENDIF
	CASE 3
		PRINTFORML 獲得一個可以讓自己比較容易和對方保持肉體關係的贈送用贵重道具——奇跡之石。
		PRINTFORML 可以吗？
		CALL ASK_YN
		IF !RESULT
			ITEM:奇跡之石 = 1
			PRINTFORMW 獲得了獨佔愛慾的奇跡之石
		ELSE
			GOTO TOKUTEN
		ENDIF
ENDSELECT