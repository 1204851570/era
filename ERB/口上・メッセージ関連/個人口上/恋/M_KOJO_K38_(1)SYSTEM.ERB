;※※※※※※※※※※※※※※※※※※※※※※※※※※
;行动成否判定
;※※※※※※※※※※※※※※※※※※※※※※※※※※
@M_KOJO_K38_FINALSCORING
;重置所有因成功判定而被调用的cflag，因为担心出现意外的问题。
CFLAG:38:1511 = 0
CFLAG:38:1512 = 0
CFLAG:38:1515 = 0
TFLAG:192 = 0
TFLAG:193 = 0

@M_KOJO_K38_TURNZERO
;特殊失败（达成特殊条件或者等于99）
IF CFLAG:38:1515 == 99
     CFLAG:38:1511 = 5
     RETURN
;大失败（1515大于95）
ELSEIF CFLAG:38:1515 > 95
     CFLAG:38:1511 = 4
     RETURN
;惨痛失败（1515除5后大于1513）
ELSEIF (CFLAG:38:1515 / 5) > CFLAG:38:1513
     CFLAG:38:1511 = 3
     RETURN
;严重失败（1515除2后大于1513）
ELSEIF (CFLAG:38:1515 / 2) > CFLAG:38:1513
     CFLAG:38:1511 = 2
     RETURN
;一般失败（1515大于1513）
ELSEIF CFLAG:38:1515 > CFLAG:38:1513
     CFLAG:38:1511 = 1
     RETURN
;特殊成功（1515达成特殊条件或者等于1）
ELSEIF CFLAG:38:1515 == 1
     CFLAG:38:1512 = 5
     RETURN
;大成功（1515小于5）
ELSEIF CFLAG:38:1515 < 5
     CFLAG:38:1512 = 4
     RETURN
;极难成功（1515小于1513除以5）
ELSEIF CFLAG:38:1515 < (CFLAG:38:1513 / 5)
     CFLAG:38:1512 = 3
     RETURN
;困难成功（1515小于1513除以2）
ELSEIF CFLAG:38:1515 < (CFLAG:38:1513 / 2)
     CFLAG:38:1512 = 2
     RETURN
;普通成功（1515小于等于1513）
ELSEIF CFLAG:38:1515 <= CFLAG:38:1513
     CFLAG:38:1512 = 1
     RETURN
ENDIF


@M_KOJO_K38_SUCCESS
SIF CFLAG:38:1590 == 2
     RETURN
;FINALSCORING重置所有被引用的数据
CALL M_KOJO_K38_FINALSCORING
;1515是100面骰子，随机生成0到99的数字，用来和1513做比较。
CFLAG:38:1515 = RAND:100
IF CFLAG:38:1514 == 1
	 ;1516记录了行动的代号，对话的代号是300。
	 SELECTCASE CFLAG:38:1516
	     CASE 300
		     ;1513代表这个行动的成功几率，随机生成一定范围的数字，如果1515的数字等于或小于1513，就强制成功，否则就强制失败。
	         CFLAG:38:1513 = RAND:60
	     CASE 301
	         CFLAG:38:1513 = RAND:120
	     CASE 363
		     CFLAG:38:1513 = RAND:100
	 ENDSELECT
	 ;1650是一个事件的编号，1650的1514意味着好结局，可以提高1513的值，提高成功几率。
	 SIF CFLAG:38:1650 == 1514
	     CFLAG:38:1513 += 40
ELSEIF CFLAG:38:1514 == 2
	 SELECTCASE CFLAG:38:1516
	     CASE 300
	         CFLAG:38:1513 = RAND:80
	     CASE 301
	         CFLAG:38:1513 = RAND:160
	     CASE 363
		     CFLAG:38:1513 = RAND:140
	 ENDSELECT
	 SIF CFLAG:38:1651 == 1514
	     CFLAG:38:1513 += 20
ELSEIF CFLAG:38:1514 == 3
	 SELECTCASE CFLAG:38:1516
	     CASE 300 || 363
	         CFLAG:38:1513 = RAND:180
	     CASE 301
	         CFLAG:38:1513 = RAND:200
	 ENDSELECT
	 SIF CFLAG:38:1651 == 1514
	     CFLAG:38:1513 += 40
	 SIF CFLAG:38:1655 == 1514
	     CFLAG:38:1513 += 10
ELSEIF CFLAG:38:1514 == 4
	 SELECTCASE CFLAG:38:1516
	     CASE 300
	         CFLAG:38:1513 = RAND:60
	     CASE 301
	         CFLAG:38:1513 = RAND:160
	     CASE 363
		     CFLAG:38:1513 = RAND:210
	 ENDSELECT
ELSEIF CFLAG:38:1514 == 5
	 SELECTCASE CFLAG:38:1516
	     CASE 300
	         CFLAG:38:1513 = RAND:120
	     CASE 301
	         CFLAG:38:1513 = RAND:200
	     CASE 363
		     CFLAG:38:1513 = RAND:150
	 ENDSELECT
ELSEIF CFLAG:38:1514 == 6
	 SELECTCASE CFLAG:38:1516
	     CASE 300 || 301
	         CFLAG:38:1513 = RAND:300
	     CASE 363
		     CFLAG:38:1513 = RAND:150
	 ENDSELECT
ELSEIF CFLAG:38:1514 == 7
	 SELECTCASE CFLAG:38:1516
	     CASE 300 || 301
	         CFLAG:38:1513 = RAND:500
	     CASE 363
		     CFLAG:38:1513 = RAND:300
	 ENDSELECT
ELSEIF CFLAG:38:1514 == 8
	 SELECTCASE CFLAG:38:1516
	     CASE 300 || 301
	         CFLAG:38:1513 = RAND:1000
	     CASE 363
		     CFLAG:38:1513 = RAND:500
	 ENDSELECT
ELSEIF CFLAG:38:1514 == 9
	 SELECTCASE CFLAG:38:1516
	     CASE 300
	         CFLAG:38:1513 = RAND:60
		 CASE 301
		     CFLAG:38:1513 = RAND:40
	     CASE 363
		     CFLAG:38:1513 = RAND:80
	 ENDSELECT
ELSEIF CFLAG:38:1514 == 10
	 SELECTCASE CFLAG:38:1516
	     CASE 300
	         CFLAG:38:1513 = RAND:20
		 CASE 301
		     CFLAG:38:1513 = RAND:10
	     CASE 363
		     CFLAG:38:1513 = RAND:40
	 ENDSELECT
ENDIF
;呼唤上面那个检定的函数
CALL M_KOJO_K38_TURNZERO
;如果1515大于1513,1511就会大于1，就是失败了。
IF CFLAG:38:1511 > 0
	 CFLAG:38:2 -= 1
	 TFLAG:192 = -1
	 TFLAG:193 = -1
	 SIF CFLAG:38:1511 > 3
		 TFLAG:193 = -2
	 RETURN
;如果1515小于1513,1512就会大于1，就是成功了。
ELSEIF CFLAG:38:1512 > 0
	 CFLAG:38:4 += 1
	 TFLAG:192 = 1
     TFLAG:193 = 0
	 IF CFLAG:38:1512 > 3
		 TFLAG:193 = 1
	     ;1512大于4，只有1%的机会，1650从0变成1，意味着1650代表的事件可以被触发了。
	     IF CFLAG:38:1512 > 4
			 SELECTCASE CFLAG:38:1514
			     CASE 1
				     SIF CFLAG:38:1650 == 0
					     CFLAG:38:1650 = 1
			     CASE 2
					 SIF CFLAG:38:1651 == 0
					     CFLAG:38:1651 = 1
			     CASE 3
				     SIF CFLAG:38:1655 == 0
					     CFLAG:38:1655 = 1
			 ENDSELECT
		 ENDIF
	 ENDIF
	 RETURN
ELSE
	 ;这个系统很明显并不好，为了预防无法顾及的地方，准备了这个安全阀。
	 TFLAG:192 = 0
	 TFLAG:193 = 0
	 RETURN
ENDIF

;※※※※※※※※※※※※※※※※※※※※※※※※※※
;位置，天气和时间的组合判定
;※※※※※※※※※※※※※※※※※※※※※※※※※※
;——————百万亿位数：主线判定值——————@M_KOJO_K38_THE_FIRST_CHOICE
;(1=1514小于四，2=1514为四五六，3=1514为八九，4=开眼睛普通，5=开眼睛恋慕)
;
;——————十万亿位数：季节——————@M_KOJO_K38_FOUR_WAYS_OF_SPICE_FLOW
;(1=春，2=夏，3=秋，4=冬)
;
;——————千亿位数至万亿位数：天气——————@M_KOJO_K38_TIME_BANDIT
;(00=晴天，01=晴天，02=小阴天/薄云，03=曇り/阴天，04=雨，05=大雨，06=霧雨，07=霧，08=雪，09=吹雪/猛吹雪，10=細雪，11=霧雪，12=雨雪交加，13=冰雹)
;(彩虹=51，钻石星辰=52，流星=53，流星群=54)
;
;——————百亿位数：所处的状态——————@M_KOJO_K38_SWEET_HOME_HERE
;(1=室外，2=下雨时在室外共用雨伞，3=室内)
;
;——————亿位数至十亿位数：节日——————@M_KOJO_K38_FOUR_WAYS_OF_SPICE_FLOW
;(无=00，万圣节(秋)=01)
;
;——————千万位数：当天时间——————@M_KOJO_K38_FOREVER_GOLDEN
;(1=早朝(AM4～6)，2=正午前(AM6～12)，3=昼(PM12～3)，4=午后(PM3～6)，5=夕(PM6～8)，6=夜(PM8～11)，7=深夜(PM11～AM4))
;
;——————千位数至百万位数：地点——————@M_KOJO_K38_JE_MAINTIENDRAI
;(太多了,0000意味着玩家在自宅区域，且和古明地恋住的区域一样)
;
;——————个位数至百位数：事件组合序号——————@M_KOJO_K38_JE_MAINTIENDRAI
;(一般都是000，只有达成特定条件才会变化，然后触发情景)
;
;红美玲和雨(下雨中，在红魔馆大门，时间是6时至12时，这时红美玲在进行看门工作)——————@M_KOJO_K38_JE_MAINTIENDRAI
;恋恋与升起的太阳(六点至七点在晴天的室外)——————@M_KOJO_K38_FOREVER_GOLDEN
;于是，这些地方都会有比较奇怪的判定，比如CFLAG:38:1515 < 20 && TIME:0 > 360 && TIME:0 < 420 && (TIME:5 == 4 || TIME:5 == 5)

@M_KOJO_K38_THE_FIRST_CHOICE
IF (CFLAG:38:1514 < 4) || CFLAG:38:1514 == 5
     CFLAG:38:1517 += 100000000000000
ELSEIF (CFLAG:38:1514 == 4 || CFLAG:38:1514 == 6)
	 CFLAG:38:1517 += 200000000000000
ELSEIF (CFLAG:38:1514 == 7 || CFLAG:38:1514 == 8)
	 CFLAG:38:1517 += 300000000000000
ELSE
	 ;未完待续
ENDIF

@M_KOJO_K38_FOUR_WAYS_OF_SPICE_FLOW
;春
IF DAY:2 == 1
     CFLAG:38:1517 += 10000000000000
;夏
ELSEIF DAY:2 == 2
     CFLAG:38:1517 += 20000000000000
;秋
ELSEIF DAY:2 == 3
     SIF DAY:3 == 30
	     CFLAG:38:1517 += 0100000000
     CFLAG:38:1517 += 30000000000000
;冬
ELSEIF DAY:2 == 4 
     CFLAG:38:1517 += 40000000000000
ENDIF

@M_KOJO_K38_TIME_BANDIT
;彩虹
IF TIME:7 == 1
     CFLAG:38:1517 += 5100000000000
	 RETURN
;钻石星辰
ELSEIF TIME:7 == 2
     CFLAG:38:1517 += 5200000000000
	 RETURN
;流星
ELSEIF TIME:7 == 3
     CFLAG:38:1517 += 5300000000000
	 RETURN
;流星群
ELSEIF TIME:7 == 4
     CFLAG:38:1517 += 5400000000000
	 RETURN
ENDIF
SELECTCASE TIME:5
     ;晴れ(晴天)
     CASE 0, 1
         CFLAG:38:1517 += 100000000000
	 ;(小阴天，薄云)
     CASE 2
         CFLAG:38:1517 += 200000000000
	 ;曇り(阴天)
	 CASE 3
         CFLAG:38:1517 += 300000000000
	 ;雨
	 CASE 4
         CFLAG:38:1517 += 400000000000
	 ;大雨
	 CASE 5
         CFLAG:38:1517 += 500000000000
	 ;霧雨
	 CASE 6
         CFLAG:38:1517 += 600000000000
	 ;霧
	 CASE 7
         CFLAG:38:1517 += 700000000000
	 ;雪
	 CASE 8
         CFLAG:38:1517 += 800000000000
	 ;吹雪,猛吹雪
	 CASE 9
         CFLAG:38:1517 += 900000000000
	 ;細雪
	 CASE 10
         CFLAG:38:1517 += 1000000000000
	 ;霧雪
	 CASE 11
         CFLAG:38:1517 += 1100000000000
	 ;雨雪交加
	 CASE 12
         CFLAG:38:1517 += 1200000000000
	 ;冰雹
	 CASE 13
         CFLAG:38:1517 += 1300000000000
ENDSELECT

@M_KOJO_K38_SWEET_HOME_HERE
;外か内か
;(在外面还是里面)
;(如果if通过，那就是在外面。)
;(如果是else，那就是在里面。)
IF (OUTROOF(CFLAG:TARGET:現在位置))
	 ;相合傘なら分岐
	 ;201是共用雨伞的状态，下冰雹时可怎么办呢
	 IF TEQUIP:201 == 1 && (TIME:5 == 4 || TIME:5 == 5)
         CFLAG:38:1517 += 20000000000
	 ELSE
		 CFLAG:38:1517 += 10000000000
	 ENDIF
	 
ELSE
	 CFLAG:38:1517 += 30000000000
ENDIF

@M_KOJO_K38_FOREVER_GOLDEN
;早朝(AM4～6)
IF TIME:2 == 1
     CFLAG:38:1517 += 10000000
;正午前(AM6～12)
ELSEIF TIME:2 == 2
     CFLAG:38:1517 += 20000000
;昼(PM12～3)
ELSEIF TIME:2 == 3
     CFLAG:38:1517 += 30000000
;午后(PM3～6)
ELSEIF TIME:2 == 4
     CFLAG:38:1517 += 40000000
;夕(PM6～8)
ELSEIF TIME:2 == 5
     CFLAG:38:1517 += 50000000
;夜(PM8～11)
ELSEIF TIME:2 == 6
     CFLAG:38:1517 += 60000000
;深夜(PM11～AM4)
ELSEIF TIME:2 == 7
     CFLAG:38:1517 += 70000000
ENDIF

@M_KOJO_K38_JE_MAINTIENDRAI
SELECTCASE CFLAG:38:現在位置
	 ;桜並木の鳥居
	 CASE 10
         CFLAG:38:1517 += 10000
	 ;神社境内
	 CASE 20
         CFLAG:38:1517 += 20000
	 ;神社本堂
	 CASE 30
         CFLAG:38:1517 += 30000
	 ;神社縁側
	 CASE 40
         CFLAG:38:1517 += 40000
	 ;妖精の大樹
	 CASE 50
         CFLAG:38:1517 += 50000
	 ;夢幻遺跡
	 CASE 60
	     CFLAG:38:1517 += 60000
	 ;お地蔵通り
	 CASE 110
	     CFLAG:38:1517 += 110000
	 ;枝垂れ柳の下
	 CASE 120
	     CFLAG:38:1517 += 120000
	 ;命蓮寺境内
	 CASE 130
	     CFLAG:38:1517 += 130000
	 ;命蓮寺本堂
	 CASE 140
	     CFLAG:38:1517 += 140000
	 ;墓地
	 CASE 150
	     CFLAG:38:1517 += 150000
	 ;聖徳道場
	 CASE 160
	     CFLAG:38:1517 += 160000
	 ;広場
	 CASE 210
	     CFLAG:38:1517 += 210000
	 ;商家屋
	 CASE 220
	     CFLAG:38:1517 += 220000
	 ;呑屋小道
	 CASE 230
         CFLAG:38:1517 += 230000
	 ;寺子屋
	 CASE 240
	     CFLAG:38:1517 += 240000
	 ;大衆浴場
	 CASE 250
	     CFLAG:38:1517 += 250000
	 ;連れ込み宿
	 CASE 260
	     CFLAG:38:1517 += 260000
	 ;長屋街
	 CASE 270
	     CFLAG:38:1517 += 270000
     ;霧の湖
	 CASE 310
	     CFLAG:38:1517 += 310000
	 ;氷のかまくら
	 CASE 320
	     CFLAG:38:1517 += 320000
	 ;廃洋館
	 CASE 330
	     CFLAG:38:1517 += 330000
	 ;正門
	 CASE 340
		 ;红美玲，工作时间:6时～12时
		 CFLAG:38:1515 = RAND:100
         IF CFLAG:38:1515 < 20 && TIME:2 == 2 && (TIME:5 == 4 || TIME:5 == 5)
		     CFLAG:38:1517 += 1
		 ENDIF
		 CFLAG:38:1517 += 340000
	 ;広間
	 CASE 350
	     CFLAG:38:1517 += 350000
     ;食堂
	 CASE 360
	     CFLAG:38:1517 += 360000
	 ;大図書館
	 CASE 370
	     CFLAG:38:1517 += 370000
	 ;地下室
	 CASE 380
	     CFLAG:38:1517 += 380000
	 ;竹林入り口
	 CASE 410
	     CFLAG:38:1517 += 410000
	 ;迷いの小道
	 CASE 420
	     CFLAG:38:1517 += 420000
	 ;斜角の竹林
	 CASE 430
	     CFLAG:38:1517 += 430000
	 ;兎の洞窟
	 CASE 440
	     CFLAG:38:1517 += 440000
	 ;永遠亭
	 CASE 450
	     CFLAG:38:1517 += 450000
	 ;無名の丘
	 CASE 460
	     CFLAG:38:1517 += 460000
	 ;太陽の畑
	 CASE 470
	     CFLAG:38:1517 += 470000
	 ;永遠亭奥ノ院
	 CASE 480
	     CFLAG:38:1517 += 480000
	 ;森の入り口
	 CASE 510
	     CFLAG:38:1517 += 510000
	 ;香霖堂
	 CASE 520
	     CFLAG:38:1517 += 520000
	 ;古木の大樹
	 CASE 530
	     CFLAG:38:1517 += 530000
	 ;霧雨魔法店
	 CASE 540
	     CFLAG:38:1517 += 540000
	 ;人形の洋館
	 CASE 550
	     CFLAG:38:1517 += 550000
	 ;再思の道
	 CASE 560
	     CFLAG:38:1517 += 560000
	 ;無縁塚
	 CASE 570
		 CFLAG:38:1517 += 570000
	 ;中有の道
	 CASE 610
		 CFLAG:38:1517 += 610000
	 ;三途の川
	 CASE 620
		 CFLAG:38:1517 += 620000
	 ;マヨヒガ
	 CASE 630
		 CFLAG:38:1517 += 630000
	 ;彼岸
	 CASE 670
		 CFLAG:38:1517 += 670000
	 ;白玉楼庭
	 CASE 680
		 CFLAG:38:1517 += 680000
	 ;白玉楼
	 CASE 690
		 CFLAG:38:1517 += 690000
	 ;麓の樹海
	 CASE 710
		 CFLAG:38:1517 += 710000
     ;玄武の沢
	 CASE 720
		 CFLAG:38:1517 += 720000
	 ;大蝦蟇の池
	 CASE 730
		 CFLAG:38:1517 += 730000
	 ;マヨヒガ
	 CASE 740
		 CFLAG:38:1517 += 740000
	 ;仙人の屋敷
	 CASE 750
		 CFLAG:38:1517 += 750000
	 ;間欠泉地下センター
	 CASE 760
		 CFLAG:38:1517 += 760000
	 ;九天の滝
	 CASE 810
		 CFLAG:38:1517 += 810000
	 ;絶景の丘
	 CASE 820
		 CFLAG:38:1517 += 820000
	 ;山の湖
	 CASE 830
		 CFLAG:38:1517 += 830000
	 ;守矢神社境内
	 CASE 840
		 CFLAG:38:1517 += 840000
	 ;守矢神社本殿
	 CASE 850
		 CFLAG:38:1517 += 850000
	 ;天界
	 CASE 890
		 CFLAG:38:1517 += 890000
	 ;幻想風穴
	 CASE 910
		 CFLAG:38:1517 += 910000
	 ;地獄の深道
	 CASE 920
		 CFLAG:38:1517 += 920000
	 ;旧地獄街道
	 CASE 930
		 CFLAG:38:1517 += 930000
	 ;旧地獄温泉
	 CASE 940
		 CFLAG:38:1517 += 940000
	 ;ラブホ
	 CASE 950
		 CFLAG:38:1517 += 950000
	 ;地霊殿
	 CASE 960
		 CFLAG:38:1517 += 950000
	 ;灼熱地獄跡
	 CASE 970
		 CFLAG:38:1517 += 970000
	 ;槐安通路
	 CASE 1010
         CFLAG:38:1517 += 1010000
	 ;月の都
     CASE 1050
         CFLAG:38:1517 += 1050000
	 ;綿月亭
	 CASE 1060
         CFLAG:38:1517 += 1060000
	 ;玉兎の街
	 CASE 1070
		 CFLAG:38:1517 += 1070000
	 ;桃林～砂浜
	 CASE 1080
		 CFLAG:38:1517 += 1080000
	 ;静かの海
	 CASE 1090
		 CFLAG:38:1517 += 1090000
	 CASEELSE
	     RETURN
ENDSELECT


;完整检定
@M_KOJO_K38_STAGING_AREA_BEAT_IN_B
CFLAG:38:1517 = 0
CALL M_KOJO_K38_THE_FIRST_CHOICE
CALL M_KOJO_K38_FOUR_WAYS_OF_SPICE_FLOW
CALL M_KOJO_K38_TIME_BANDIT
CALL M_KOJO_K38_SWEET_HOME_HERE
CALL M_KOJO_K38_FOREVER_GOLDEN
CALL M_KOJO_K38_JE_MAINTIENDRAI

;去除主线检定
@M_KOJO_K38_WAR_NEVER_CHANGE
CFLAG:38:1517 = 0
CALL M_KOJO_K38_FOUR_WAYS_OF_SPICE_FLOW
CALL M_KOJO_K38_TIME_BANDIT
CALL M_KOJO_K38_SWEET_HOME_HERE
CALL M_KOJO_K38_FOREVER_GOLDEN
CALL M_KOJO_K38_JE_MAINTIENDRAI

;去除四季检定
@M_KOJO_K38_WIND_AND_RAIN_CAME_JUST_IN_TIME
CFLAG:38:1517 = 0
CALL M_KOJO_K38_THE_FIRST_CHOICE
CALL M_KOJO_K38_TIME_BANDIT
CALL M_KOJO_K38_SWEET_HOME_HERE
CALL M_KOJO_K38_FOREVER_GOLDEN
CALL M_KOJO_K38_JE_MAINTIENDRAI

;去除天气检定
@M_KOJO_K38_WHEN_THE_CHERRY_BLOSSOMS_SCATTER
CFLAG:38:1517 = 0
CALL M_KOJO_K38_THE_FIRST_CHOICE
CALL M_KOJO_K38_FOUR_WAYS_OF_SPICE_FLOW
CALL M_KOJO_K38_SWEET_HOME_HERE
CALL M_KOJO_K38_FOREVER_GOLDEN
CALL M_KOJO_K38_JE_MAINTIENDRAI

;※※※※※※※※※※※※※※※※※※※※※※※※※※
;古明地恋的主线状态判定
;※※※※※※※※※※※※※※※※※※※※※※※※※※
;小铃口上借物
@M_KOJO_K38_HEART
;1510大于0，意味着这个口上的debug开启了，无视主线判定
IF CFLAG:38:1510 == 1
     RETURN
;1003等于1，意味着【快餐模式】开启，主线判定变得宽松
ELSEIF CFLAG:38:1003 == 1
     CALL M_KOJO_K38_MILLENNIUM_UTOPIA
	 RETURN
;1004等于于1，意味着【尊重原著模式】开启，使用简短的主线
ELSEIF CFLAG:38:1004 == 1
     CALL M_KOJO_K38_SHIN_CHITSUJYO_NO_KANSHOU
	 RETURN
;影逝
ELSEIF (CFLAG:38:4 > 50000 && CFLAG:38:1116 == 3) || (CFLAG:38:1118 > 0)
     IF CFLAG:38:1118 == 1
         CFLAG:38:1118 = 2
         CFLAG:38:1514 = 12
	 ELSEIF CFLAG:38:1118 > 1
	     CFLAG:38:1514 = 12
	 ELSE
         CFLAG:38:1116 = 0
	     CFLAG:38:4 = 0
	     CFLAG:38:2 = 0
	 ENDIF
;神伤
ELSEIF CFLAG:38:1116 == 3 && CFLAG:38:1117 != 1
     CFLAG:38:1514 = 11
;人偶
ELSEIF TALENT:淫乱 && CFLAG:38:1117 != 1
	 CFLAG:38:1514 = 10
	 CFLAG:38:1116 = 2
	 RETURN
;崩坏
ELSEIF CFLAG:38:1112 > 0
	 CFLAG:38:1514 = 9
	 CFLAG:38:1116 = 1
	 RETURN
;恋恋
ELSEIF (TALENT:恋慕 && TALENT:恋人 && CFLAG:38:4 > 50000 && CFLAG:38:1117 != 1) || (CFLAG:38:1115 == 2)
	 SIF CFLAG:38:1114 == 0
	     CFLAG:38:1114 = 1
	 SIF CFLAG:38:1115 == 1
	     CFLAG:38:1115 = 2
	 CFLAG:38:1514 = 8
	 RETURN
;清明
ELSEIF (TALENT:恋慕 && TALENT:恋人 && CFLAG:38:4 > 25000 && CFLAG:38:1117 != 1) || (CFLAG:38:1115 == 1)
	 SIF CFLAG:38:1114 == 0
	     CFLAG:38:1114 = 1
	 SIF CFLAG:38:1115 == 0
	     CFLAG:38:1115 = 1
	 CFLAG:38:1514 = 7
	 RETURN
;平和
ELSEIF (TALENT:恋慕 && TALENT:恋人 && CFLAG:38:4 > 10000 && CFLAG:38:1117 != 1)
	 SIF CFLAG:38:1114 == 0
	     CFLAG:38:1114 = 1
	 SIF CFLAG:38:1500 == 5
	     CFLAG:38:1500 = 6
	 CFLAG:38:1514 = 6
	 RETURN
;应援
ELSEIF CFLAG:38:1114 == 1 && CFLAG:38:4 < 2500 && CFLAG:38:1001 == 1 && CFLAG:38:1114 == 1
	 IF (TALENT:恋慕 || TALENT:恋人)
	     IF CFLAG:38:1500 == 4
		     CFLAG:38:2 += 1250
	         CFLAG:38:4 += 2500
		 ELSEIF CFLAG:38:1500 == 5
		     CFLAG:38:2 += 3650
	         CFLAG:38:4 += 7500
		 ELSEIF CFLAG:38:1500 == 6
		     CFLAG:38:2 += 8650
	         CFLAG:38:4 += 17500
		 ENDIF
	 ENDIF
	 CFLAG:38:1514 = 5
	 RETURN
;困惑
ELSEIF ((TALENT:恋慕 || TALENT:恋人) && CFLAG:38:4 > 5000) || ((CFLAG:38:1117 == 1) && CFLAG:38:4 < 6000)
	 SIF CFLAG:38:1114 == 0
	     CFLAG:38:1114 = 1
	 SIF CFLAG:38:1500 == 4
	     CFLAG:38:1500 = 5
	 CFLAG:38:1514 = 4
	 RETURN
;狂气(恋慕)
ELSEIF (TALENT:恋慕 && TALENT:恋人) || ((CFLAG:38:1117 == 1) && CFLAG:38:4 < 6500)
	 SIF CFLAG:38:1114 == 0
	     CFLAG:38:1114 = 1
     SIF CFLAG:38:1500 == 3
	     CFLAG:38:1500 = 4
	 CFLAG:38:1514 = 3
	 RETURN
;杀意(思慕)
ELSEIF (TALENT:思慕) || ((CFLAG:38:1117 == 1) && CFLAG:38:4 < 6666)
     SIF CFLAG:38:1500 == 0
	     CFLAG:38:1500 = 1
	 CFLAG:38:1514 = 2
	 RETURN
;空洞(刚开始见面的状态)
ELSE
	 CFLAG:38:1514 = 1
	 RETURN
ENDIF

;【快餐模式】专用主线，像建立千年乌托邦那样轻松
@M_KOJO_K38_MILLENNIUM_UTOPIA
IF CFLAG:38:1004 == 1
     CALL M_KOJO_K38_SHIN_CHITSUJYO_NO_KANSHOU
	 RETURN
;影逝
ELSEIF (CFLAG:38:4 > 25000 && CFLAG:38:1116 == 3) || (CFLAG:38:1118 > 0)
     IF CFLAG:38:1118 == 1
         CFLAG:38:1118 = 2
         CFLAG:38:1514 = 12
	 ELSEIF CFLAG:38:1118 > 1
	     CFLAG:38:1514 = 12
	 ELSE
         CFLAG:38:1116 = 0
	     CFLAG:38:4 = 0
	     CFLAG:38:2 = 0
	 ENDIF
;神伤
ELSEIF CFLAG:38:1116 == 3 && CFLAG:38:1117 != 1
     CFLAG:38:1514 = 11
;人偶
ELSEIF TALENT:淫乱 && CFLAG:38:1117 != 1
	 CFLAG:38:1514 = 10
	 CFLAG:38:1116 = 2
	 RETURN
;崩坏
ELSEIF CFLAG:38:1112 > 0
	 CFLAG:38:1514 = 9
	 CFLAG:38:1116 = 1
	 RETURN
;恋恋
ELSEIF (TALENT:恋慕 && TALENT:恋人 && CFLAG:38:4 > 25000 && CFLAG:38:1117 != 1) || (CFLAG:38:1115 == 2)
	 SIF CFLAG:38:1114 == 0
	     CFLAG:38:1114 = 1
	 SIF CFLAG:38:1115 == 1
	     CFLAG:38:1115 = 2
	 CFLAG:38:1514 = 8
	 RETURN
;清明
ELSEIF (TALENT:恋慕 && TALENT:恋人 && CFLAG:38:4 > 10000 && CFLAG:38:1117 != 1) || (CFLAG:38:1115 == 1)
	 SIF CFLAG:38:1114 == 0
	     CFLAG:38:1114 = 1
	 SIF CFLAG:38:1115 == 0
	     CFLAG:38:1115 = 1
	 CFLAG:38:1514 = 7
	 RETURN
;平和
ELSEIF (TALENT:恋慕 && TALENT:恋人 && CFLAG:38:4 > 5000 && CFLAG:38:1117 != 1)
	 SIF CFLAG:38:1114 == 0
	     CFLAG:38:1114 = 1
	 SIF CFLAG:38:1500 == 5
	     CFLAG:38:1500 = 6
	 CFLAG:38:1514 = 6
	 RETURN
;应援
ELSEIF CFLAG:38:1114 == 1 && CFLAG:38:4 < 1250 && CFLAG:38:1001 == 1 && CFLAG:38:1114 == 1
		 ;如果一次热胀冷缩都没读过也有效
	     IF CFLAG:38:1500 == 1 || CFLAG:38:1500 == 2
			 CFLAG:38:1500 = 4
		 ;到达恋人之后，根据上周目热胀冷缩的数值来继承数据
		 ELSEIF CFLAG:38:1500 == 4
		     CFLAG:38:2 += 625
	         CFLAG:38:4 += 1250
		 ELSEIF CFLAG:38:1500 == 5
		     CFLAG:38:2 += 1625
	         CFLAG:38:4 += 3250
		 ELSEIF CFLAG:38:1500 == 6
		     CFLAG:38:2 += 3650
	         CFLAG:38:4 += 7500
		 ENDIF
	 CFLAG:38:1514 = 5
	 RETURN
;困惑
ELSEIF ((TALENT:恋慕 || TALENT:恋人) && CFLAG:38:4 > 2500) || ((CFLAG:38:1117 == 1) && CFLAG:38:4 < 6000)
	 SIF CFLAG:38:1114 == 0
	     CFLAG:38:1114 = 1
	 SIF CFLAG:38:1500 == 4
	     CFLAG:38:1500 = 5
	 CFLAG:38:1514 = 4
	 RETURN
;狂气(恋慕)
ELSEIF (TALENT:恋慕 && TALENT:恋人) || ((CFLAG:38:1117 == 1) && CFLAG:38:4 < 6500)
	 SIF CFLAG:38:1114 == 0
	     CFLAG:38:1114 = 1
     SIF CFLAG:38:1500 == 3
	     CFLAG:38:1500 = 4
	 CFLAG:38:1514 = 3
	 RETURN
;杀意(思慕)
ELSEIF (TALENT:思慕) || ((CFLAG:38:1117 == 1) && CFLAG:38:4 < 6666)
     SIF CFLAG:38:1500 == 0
	     CFLAG:38:1500 = 1
	 CFLAG:38:1514 = 2
	 RETURN
;空洞(刚开始见面的状态)
ELSE
	 CFLAG:38:1514 = 1
	 RETURN
ENDIF

;【尊重原著模式】专用主线，新秩序之完胜，您赢了
@M_KOJO_K38_SHIN_CHITSUJYO_NO_KANSHOU
;狂气(恋慕)
IF (TALENT:恋慕 && TALENT:恋人)
	 CFLAG:38:1514 = 3
	 RETURN
;杀意(思慕)
ELSEIF (TALENT:思慕)
	 CFLAG:38:1514 = 2
	 RETURN
;空洞(刚开始见面的状态)
ELSE
	 CFLAG:38:1514 = 1
	 RETURN
ENDIF

;※※※※※※※※※※※※※※※※※※※※※※※※※※
;周目轮回，重置数据
;※※※※※※※※※※※※※※※※※※※※※※※※※※
@M_KOJO_K38_START
;1510大于0，意味着这个口上的debug开启了，可以进行事件cflag的操控。
IF CFLAG:38:1510 == 1
     PRINTFORMW 
     PRINTFORMW 「那么那么！是必然事件还是随机事件？」
     PRINTFORMW 「应该，是这样说的吧？」
     PRINTFORMW 「嘛，其实也挺有趣的。」
     PRINTFORMW 
	 PRINTFORML [0]-练习必然事件。
	 PRINTFORML [1]-练习随机事件。
	 INPUT
	 SELECTCASE RESULT
	     CASE 0
		     CFLAG:38:1601 = 0
             CFLAG:38:1602 = 0
             CFLAG:38:1603 = 0
             CFLAG:38:1604 = 0
	         PRINTFORMW 「恋恋准备好了！」
		     PRINTFORML [0]-加油吧。
		     PRINTFORMW 「嗯嗯！大家一起努力！」
		     PRINTFORMW 
		 CASE 1
		     PRINTFORMW 「你还没有教呢————！」
		     PRINTFORML [0]-抱歉。
		     INPUT
			 CFLAG:38:1651 = 1
			 CFLAG:38:1500 = 3
			 CFLAG:38:1655 = 1
		     PRINTFORMW 「哼哼～」
		     PRINTFORMW 
	 ENDSELECT
ELSE
     ;移除上周目坏结局的指标，在初次见面里
	 ;如果不开启二周目模式，可继承数值也会删除。
	 IF CFLAG:38:1001 != 1
	     ;热胀冷缩
	     CFLAG:38:1500 = 0
		 ;御伽草子
		 CFLAG:38:1509 = 0
		 ;博丽和八云紫的得分
		 CFLAG:38:1119 = 0
		 CFLAG:38:1120 = 0
	 ENDIF
	 ;重置两个模式
	 CFLAG:38:1003 = 0
	 CFLAG:38:1004 = 0
	 ;重置所有事件
	 CFLAG:38:1600 = 0
	 CFLAG:38:1601 = 0
	 CFLAG:38:1602 = 0
	 CFLAG:38:1603 = 0
	 CFLAG:38:1604 = 0
	 CFLAG:38:1605 = 0
	 CFLAG:38:1606 = 0
	 CFLAG:38:1607 = 0
	 CFLAG:38:1651 = 0
ENDIF

;※※※※※※※※※※※※※※※※※※※※※※※※※※
;口上debug模式
;※※※※※※※※※※※※※※※※※※※※※※※※※※
@M_KOJO_K38_DEBUG
REPEAT 38
     CFLAG:38:1510 = 1
     PRINTFORMW 「诶————是来检测学习成果的啊……」
     PRINTFORML [0]-放轻松，换换心态
     PRINTFORML [1]-保持这样的状态排练一下。
     PRINTFORML [9]-目前来说就这样罢
     INPUT
     SELECTCASE RESULT
	     CASE 0
	     PRINTFORMW 「恋恋会加油的！」
	     PRINTFORML [1]-发呆休息一下，空洞。
	     PRINTFORML [2]-来点精气神，杀意。
	     PRINTFORML [3]-虽然会有些辛苦，狂气。
	     PRINTFORML [4]-把这本哲学书拿去读几段，困惑。
	     PRINTFORML [5]-模拟一个新的开始，应援。
	     PRINTFORML [6]-喝杯茶休息休息再继续，平和。
	     PRINTFORML [7]-放轻松就好了，清明。
	     PRINTFORML [8]-做回你自己，恋恋。
	     PRINTFORML [9]-还要请几个群众演员，崩坏。
	     PRINTFORML [10]-记得告诉他们盒饭领取的位置，人偶。
	     PRINTFORML [11]-这是最轻松的，神伤。
	     PRINTFORML [12]-别管这个，影逝。
	     INPUT
	     SELECTCASE RESULT
		     CASE 1
		     CFLAG:38:1514 = 1
			 CASE 2
		     CFLAG:38:1514 = 2
			 CASE 3
		     CFLAG:38:1514 = 3
			 CASE 4
		     CFLAG:38:1514 = 4
			 CASE 5
		     CFLAG:38:1514 = 5
			 CASE 6
		     CFLAG:38:1514 = 6
			 CASE 7
		     CFLAG:38:1514 = 7
			 CASE 8
		     CFLAG:38:1514 = 8
			 CASE 9
		     CFLAG:38:1514 = 9
			 CASE 10
		     CFLAG:38:1514 = 10
			 CASE 11
		     CFLAG:38:1514 = 11
			 CASE 12
		     CFLAG:38:1514 = 12
		 ENDSELECT
		 CASE 1
		 CALL M_KOJO_K38_START
		 CASE 9
		 PRINTFORMW 「真辛苦啊～～」
		 CFLAG:38:2 = 1000000
		 CFLAG:38:4 = 1000000
		 BREAK
	 ENDSELECT
REND